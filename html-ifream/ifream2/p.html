<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>JSP Page</title>
    </head>
	<body>
		我是父
		<a href="javascript:;" id="p" >父的事件</a>
		<span id="p2">p2的点击事件</span>
		<select id="p3" onchange="dom2()">
			<option>1</option>
			<option>2</option>
			<option>3</option>
		</select>
		<iframe id="iframe" src="s.html"></iframe>
	</body>
	<script src="../../js/jquery.js"></script>
	<script src="../../js-插件/xmodal/xmodal.js"></script>
	<script>
    //子window加载完成
   iframe.contentWindow.addEventListener("load",function(){
        let win =iframe.contentWindow;
        win.document.body.innerHTML = "<a>我是注入进来的</a>";
        //脚本注入
        var bodyDom = win.document.body;
        dynamicLoadScript(bodyDom,function(){
          console.log(6666);
        })
	  })
window.addEventListener("load",function(){
      console.log("父完成");
      console.log(iframe.contentWindow);
			//父页面加载完成
    })

    function dynamicLoadJs(url, callback) {
  var bodyDom = document.getElementsByTagName('body')[0];
  
  var script = document.createElement('script');
  
  script.type = 'text/javascript';
  
  script.src = url;
  
  if(typeof(callback)=='function'){
    script.onload = script.onreadystatechange = function () {
      if(!this.readyState || this.readyState === "loaded" || this.readyState === "complete"){
          callback();
          script.onload = script.onreadystatechange = null;
      }
    };
  }
  
  bodyDom.appendChild(script);
}

function dynamicLoadScript(dom,Fn) {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.innerHTML=`eval(~${Fn.toString()}())`;
  dom.appendChild(script);
}


		/*function dom2(){
			alert("p3");
		}*/
		/*$("body").on("click","#p2",()=>{
			alert("p2");
		});
		$("body").on("change","#p3",()=>{
			alert("p3");
		});
		/*window.onload = function(){
			$("#p3").trigger("change")
		}*/
		
		
		//本次测试总结
		/**
		 * 注意点：
		 *1.在使用iframe框架的时候  注意  所以的父子操作 需要加 window.onload事件
		 *2.事件代理--模拟点击   因为jquery的trigger模拟点击是基于当前window的  所以模拟点击无效，，亲测原生的js有效  只限于模拟点击  dom.click()  当然下拉框没有dom.change()方法的
		 *3.dom2级事件绑定的形式  on  或者 click(),同上所述  不能在子trigger(eventName)触发  需要用原生
		 *4.dom0级事件绑定的形式 (是指在标签上写事件)  是可以在子trigger(eventName)触发  change等事件亲测有效
		 * 
		 * 解决方案：
		 * 1.事件绑定都由当前界面去完成，模拟点击都不可信,可同赋值变量，再次去初始化,这样做有可能事件重复
		 * 2.用过URL去刷新界面去判断
		 */
	</script>
  </html>